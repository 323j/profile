// features.js - ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ููุฅุตุฏุงุฑ 11.0

// 1. ูุคุดุฑ ุฅููุงู ุงูููู ุงูุดุฎุตู
function initProfileCompletion() {
    const completionContainer = document.createElement('div');
    completionContainer.className = 'completion-container animate__animated animate__fadeInDown';
    completionContainer.innerHTML = `
        <div class="completion-header">
            <span>ุฅููุงู ุงูููู ุงูุดุฎุตู</span>
            <span id="completion-text">0% ููุชูู</span>
        </div>
        <div class="completion-bar">
            <div class="completion-progress" id="completion-bar"></div>
        </div>
    `;
    
    document.querySelector('.container').prepend(completionContainer);

    function updateProfileCompletion() {
        const sections = document.querySelectorAll('.card');
        const viewedSections = Array.from(sections).filter(section => {
            const rect = section.getBoundingClientRect();
            return rect.top < window.innerHeight - 100 && rect.bottom >= 100;
        }).length;

        const completionPercentage = Math.min(Math.round((viewedSections / sections.length) * 100), 100);
        document.getElementById('completion-bar').style.width = `${completionPercentage}%`;
        document.getElementById('completion-text').textContent = `${completionPercentage}% ููุชูู`;

        if (completionPercentage >= 80 && !localStorage.getItem('completionAchievement')) {
            showNotification('ุฑุงุฆุน! ููุฏ ุงุณุชุนุฑุถุช ูุนุธู ูููู ุงูุดุฎุตู ๐', 'var(--edit-color)');
            localStorage.setItem('completionAchievement', 'true');
        }
    }

    window.addEventListener('scroll', updateProfileCompletion);
    window.addEventListener('load', updateProfileCompletion);
}

// 2. ูุณู ุงููุดุงุฑูุน
function initProjectsSection() {
    const projectsHTML = `
    <div class="card projects animate-on-scroll" id="projects">
        <h2><i class="fas fa-code-branch"></i> ูุดุงุฑูุนู</h2>
        <div class="swiper projects-swiper">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <div class="project-card">
                        <img src="https://via.placeholder.com/400x250" alt="ูุดุฑูุน 1">
                        <h3>ูููุน ุชุฌุงุฑุฉ ุฅููุชุฑูููุฉ</h3>
                        <p>ุชูููุงุช ุงููุณุชุฎุฏูุฉ: React, Node.js, MongoDB</p>
                        <a href="#" class="project-link">ุนุฑุถ ุงููุดุฑูุน</a>
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="project-card">
                        <img src="https://via.placeholder.com/400x250" alt="ูุดุฑูุน 2">
                        <h3>ุชุทุจูู ุฅุฏุงุฑุฉ ุงูููุงู</h3>
                        <p>ุชูููุงุช ุงููุณุชุฎุฏูุฉ: Flutter, Firebase</p>
                        <a href="#" class="project-link">ุนุฑุถ ุงููุดุฑูุน</a>
                    </div>
                </div>
            </div>
            <div class="swiper-pagination"></div>
        </div>
    </div>
    `;
    
    // ุฅุถุงูุฉ ูุณู ุงููุดุงุฑูุน ูุจู ูุณู ุงูููุงุฑุงุช
    const skillsSection = document.querySelector('.skills');
    skillsSection.insertAdjacentHTML('beforebegin', projectsHTML);

    // ุชููุฆุฉ Swiper ูููุดุงุฑูุน
    new Swiper('.projects-swiper', {
        loop: true,
        pagination: {
            el: '.projects-swiper .swiper-pagination',
            clickable: true,
        },
        slidesPerView: 1,
        spaceBetween: 20,
        breakpoints: {
            768: {
                slidesPerView: 2,
            }
        }
    });
}

// 3. ูุณู ุงูุชููููุงุช
function initTestimonialsSection() {
    const testimonialsHTML = `
    <div class="card testimonials animate-on-scroll" id="testimonials">
        <h2><i class="fas fa-star"></i> ุชููููุงุช ุงูุนููุงุก</h2>
        <div class="swiper testimonials-swiper">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <div class="testimonial-card">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="ุนููู 1">
                        <div class="stars">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                        </div>
                        <p>"ุฃุญูุฏ ูุญุชุฑู ุฌุฏูุง ูู ุนูููุ ุฃูุฌุฒ ุงููุดุฑูุน ูุจู ุงูููุนุฏ ุงููุญุฏุฏ ูุจุฌูุฏุฉ ุนุงููุฉ."</p>
                        <h4>- ูุญูุฏ ุนูู</h4>
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="testimonial-card">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="ุนููู 2">
                        <div class="stars">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                        </div>
                        <p>"ุณุนูุฏ ุฌุฏูุง ุจุงูุชุนุงูู ูุน ุฃุญูุฏุ ููุฏู ุญูููุงู ุฅุจุฏุงุนูุฉ ูุงุญุชุฑุงููุฉ."</p>
                        <h4>- ุณุงุฑุฉ ุฃุญูุฏ</h4>
                    </div>
                </div>
            </div>
            <div class="swiper-pagination"></div>
        </div>
    </div>
    `;
    
    // ุฅุถุงูุฉ ูุณู ุงูุชููููุงุช ุจุนุฏ ูุณู ุงููุดุงุฑูุน
    const projectsSection = document.getElementById('projects');
    projectsSection.insertAdjacentHTML('afterend', testimonialsHTML);

    // ุชููุฆุฉ Swiper ููุชููููุงุช
    new Swiper('.testimonials-swiper', {
        loop: true,
        pagination: {
            el: '.testimonials-swiper .swiper-pagination',
            clickable: true,
        },
        autoplay: {
            delay: 5000,
        },
    });
}

// 4. ูุณู ุงููุฏููุฉ
function initBlogSection() {
    const blogHTML = `
    <div class="card blog animate-on-scroll" id="blog">
        <h2><i class="fas fa-pen"></i> ุฃุญุฏุซ ุงูููุงูุงุช</h2>
        <div class="blog-list">
            <div class="blog-item">
                <h3>ููููุฉ ุฅูุดุงุก ูููุน ุดุฎุตู ูููุฒ</h3>
                <p class="blog-date">10 ููุงูุฑ 2024</p>
                <p>ุฏููู ุดุงูู ูุฅูุดุงุก ูููุน ุดุฎุตู ูุนุฑุถ ููุงุฑุงุชู ููุจุฑุฒ ุฅูุฌุงุฒุงุชู.</p>
                <a href="#" class="read-more">ูุฑุงุกุฉ ุงููุฒูุฏ <i class="fas fa-arrow-left"></i></a>
            </div>
            <div class="blog-item">
                <h3>ุฃูุถู ุฃุฏูุงุช ุชุทููุฑ ุงูููุจ ูู 2024</h3>
                <p class="blog-date">5 ููุงูุฑ 2024</p>
                <p>ุชุนุฑู ุนูู ุฃุญุฏุซ ุงูุฃุฏูุงุช ูุงูููุชุจุงุช ุงูุชู ุณุชุณุงุนุฏู ูู ุชุทููุฑ ุงูููุจ.</p>
                <a href="#" class="read-more">ูุฑุงุกุฉ ุงููุฒูุฏ <i class="fas fa-arrow-left"></i></a>
            </div>
        </div>
        <a href="#" class="view-all">ุนุฑุถ ุฌููุน ุงูููุงูุงุช <i class="fas fa-arrow-left"></i></a>
    </div>
    `;
    
    // ุฅุถุงูุฉ ูุณู ุงููุฏููุฉ ุจุนุฏ ูุณู ุงูุชููููุงุช
    const testimonialsSection = document.getElementById('testimonials');
    testimonialsSection.insertAdjacentHTML('afterend', blogHTML);
}

// 5. ูููุฐุฌ ุงูุงุชุตุงู ู QR Code
function initContactSection() {
    const contactHTML = `
    <div class="card contact animate-on-scroll" id="contact">
        <h2><i class="fas fa-envelope"></i> ุชูุงุตู ูุนู</h2>
        <form class="contact-form" id="contact-form">
            <input type="text" name="name" placeholder="ุงุณูู" required>
            <input type="email" name="email" placeholder="ุจุฑูุฏู ุงูุฅููุชุฑููู" required>
            <textarea name="message" placeholder="ุฑุณุงูุชู" rows="4" required></textarea>
            <button type="submit">ุฅุฑุณุงู ุงูุฑุณุงูุฉ</button>
        </form>
        
        <div class="qrcode-container">
            <h3><i class="fas fa-qrcode"></i> ุดุงุฑู ูููู ุงูุดุฎุตู</h3>
            <div id="qrcode"></div>
            <p>ูุณุญ ุงูููุฏ ููุดุงุฑูุฉ ุงููููุน</p>
        </div>
    </div>
    `;
    
    // ุฅุถุงูุฉ ูุณู ุงูุงุชุตุงู ูู ููุงูุฉ ุงููุญุชูู
    const container = document.querySelector('.container');
    container.insertAdjacentHTML('beforeend', contactHTML);

    // ุชููุฆุฉ ูููุฐุฌ ุงูุงุชุตุงู
    document.getElementById('contact-form').addEventListener('submit', function(e) {
        e.preventDefault();
        showNotification('ุดูุฑูุง ูู! ุณูุฑุฏ ุนูู ุฑุณุงูุชู ูุฑูุจูุง.', 'var(--primary-color)');
        this.reset();
    });

    // ุชูููุฏ QR Code
    if (typeof QRCode !== 'undefined') {
        new QRCode(document.getElementById('qrcode'), {
            text: window.location.href,
            width: 150,
            height: 150,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
    }
}

// 6. ุชุจุฏูู ุงููุบุฉ
function initLanguageSwitcher() {
    const languageHTML = `
    <div class="language-switcher">
        <button class="language-btn" id="language-btn">
            <i class="fas fa-language"></i>
            <span id="language-text">English</span>
        </button>
    </div>
    `;
    
    document.body.insertAdjacentHTML('afterbegin', languageHTML);

    const languageBtn = document.getElementById('language-btn');
    const languageText = document.getElementById('language-text');
    let currentLanguage = 'ar';

    languageBtn.addEventListener('click', () => {
        currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
        languageText.textContent = currentLanguage === 'ar' ? 'English' : 'ุงูุนุฑุจูุฉ';
        showNotification(currentLanguage === 'ar' ? 'ุชู ุงูุชุจุฏูู ุฅูู ุงูุนุฑุจูุฉ' : 'Switched to English');
    });
}

// 7. ุชุฃุซูุฑุงุช ุงูุญุฑูุฉ
function initAnimations() {
    function checkScroll() {
        const elements = document.querySelectorAll('.animate-on-scroll');
        elements.forEach(element => {
            const rect = element.getBoundingClientRect();
            if (rect.top < window.innerHeight - 100) {
                element.classList.add('visible');
            }
        });
    }

    window.addEventListener('scroll', checkScroll);
    window.addEventListener('load', checkScroll);
}

// ุฏุงูุฉ ูุณุงุนุฏุฉ ูุนุฑุถ ุงูุฅุดุนุงุฑุงุช
function showNotification(message, bgColor = 'var(--edit-color)') {
    const notification = document.createElement('div');
    notification.className = 'card';
    notification.style.position = 'fixed';
    notification.style.bottom = '20px';
    notification.style.right = '20px';
    notification.style.zIndex = '1000';
    notification.style.padding = '15px';
    notification.style.backgroundColor = bgColor;
    notification.style.color = 'white';
    notification.style.borderRadius = '10px';
    notification.style.boxShadow = '0 4px 10px rgba(0,0,0,0.2)';
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.5s ease';
        setTimeout(() => notification.remove(), 500);
    }, 3000);
}

// ุชููุฆุฉ ุฌููุน ุงูููุฒุงุช
function initAllFeatures() {
    initProfileCompletion();
    initProjectsSection();
    initTestimonialsSection();
    initBlogSection();
    initContactSection();
    initLanguageSwitcher();
    initAnimations();
}

// ุชููุฆุฉ ุงูููุฒุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
document.addEventListener('DOMContentLoaded', initAllFeatures);
